# This snap will build kubo from source.
name: repository-connection-test
summary: global, versioned, peer-to-peer filesystem # 79 char long summary
description: |
  Kubo is not distributed through Snap anymore (https://github.com/ipfs/kubo/issues/8688).
  Please download Kubo from https://dist.ipfs.tech/#kubo.

# fetch the version number in the `ipfs` part rather than hardcode it here
# see: https://snapcraft.io/docs/using-external-metadata#heading--scriptlet
adopt-info: ipfs
base: core18
grade: stable
confinement: strict
source-code: https://github.com/ipfs/kubo
website: https://github.com/ipfs/kubo

apps:
  ipfs:
    command: ipfs

parts:
  ipfs:
    source: '.'
    source-tag: master
    plugin: go
    # keep me up to date with the go version that kubo expects to be built with.
    go-channel: latest/stable
    go-importpath: github.com/ipfs/kubo
    build-packages:
        - build-essential

    # use `make` to build and set the snap version from `ipfs version` output
    override-build: |
      export GOPATH=$SNAPCRAFT_PART_BUILD/go
      go install ./cmd/ipfs
      cp $SNAPCRAFT_PART_BUILD/go/bin/ipfs $SNAPCRAFT_PART_INSTALL
      snapcraftctl set-version "$(cat .version | xargs)"
